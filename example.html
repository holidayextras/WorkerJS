<!doctype html>
<html>
	<head>
	  <script type="text/javascript" src="./WorkerJS.js"></script>
	  <script type="text/javascript">
	    var primes=[];
	    var unit = 1;
	    var finished = false;
	    
	    WorkerJS({ // TLDR; Functions we want to push into the Worker scope.
	      addPrime: function(somePrime) {
	        primes.push(somePrime);
	      },
	      getUnit: function() {
	        this.callback(unit++);
	      }
	    }, function() { // TLDR; Definition of the Worker.
	      function testIfPrime() {
	        log("Worker starting up...");
	        var self = this;
	        
	        var processNextUnit = function() {
	          getUnit(function(i) {
	            if (i>100000) return self.callback("Success");
	            var prime = true;
	            for (var j=2; j<i; j++) {
	              if ( (i%j) == 0 ) {
	                prime = false;
	                break;
	              }
	            }
	            if (prime) addPrime(i);
	            return processNextUnit();
	          });
	        };
	        processNextUnit();
	      };
	    }, function(instances) { // TLDR; Interacting with the Worker(s).
	      console.log("Gateway has been called.");
	      instances.testIfPrime(function(result) {
	        console.log("Gateway callback - Done!", primes, result);
	        finished = true;
	      });
	    }, 7);
	    
	    // This demonstrates the parallel nature of this demo.
	    var checkProgress = function() {
	      console.log("Found", primes.length, "primes");
	      if (!finished) setTimeout(checkProgress, 1000);
	    };
	    checkProgress();
	  </script>
	</head>
</html>
